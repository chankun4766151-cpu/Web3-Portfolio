# ğŸ“š EIP-7702 æŠ€æœ¯è¯´æ˜

## ğŸ¯ ä»€ä¹ˆæ˜¯ EIP-7702ï¼Ÿ

EIP-7702 æ˜¯ä»¥å¤ªåŠçš„ä¸€ä¸ªæ–°ææ¡ˆï¼Œå…è®¸**æ™®é€šè´¦æˆ·ï¼ˆEOAï¼‰ä¸´æ—¶è·å¾—æ™ºèƒ½åˆçº¦çš„èƒ½åŠ›**ã€‚

### æ ¸å¿ƒæ¦‚å¿µ

- **EOAï¼ˆå¤–éƒ¨è´¦æˆ·ï¼‰**ï¼šæ™®é€šçš„é’±åŒ…è´¦æˆ·ï¼Œé€šè¿‡ç§é’¥æ§åˆ¶
- **æ™ºèƒ½åˆçº¦è´¦æˆ·**ï¼šå¯ä»¥æ‰§è¡Œå¤æ‚é€»è¾‘ï¼Œä½†é€šå¸¸éœ€è¦é¢„å…ˆéƒ¨ç½²
- **EIP-7702 æˆæƒ**ï¼šè®© EOA ä¸´æ—¶"å‡çº§"ä¸ºæ™ºèƒ½åˆçº¦è´¦æˆ·

### ä¼˜åŠ¿

1. **æ‰¹é‡æ“ä½œ**ï¼šåœ¨ä¸€ä¸ªäº¤æ˜“ä¸­æ‰§è¡Œå¤šä¸ªæ“ä½œï¼ˆApprove + Depositï¼‰
2. **èŠ‚çœ Gas**ï¼šå‡å°‘äº¤æ˜“æ•°é‡
3. **ä¿ç•™ EOA ç‰¹æ€§**ï¼šæˆæƒæ˜¯ä¸´æ—¶çš„ï¼Œä¸æ”¹å˜è´¦æˆ·æœ¬è´¨

---

## ğŸ”§ å®ç°åŸç†

### 1. å…³é”®ç»„ä»¶

#### Delegator åˆçº¦
```solidity
// MetaMask å®˜æ–¹ Delegator: 0x63c0c19a282a1B52b07dD5a65b58948A07DAE32B
contract Delegator {
    function execute(Execution[] executions) external payable {
        // æ‰¹é‡æ‰§è¡Œå¤šä¸ªè°ƒç”¨
    }
}
```

#### ç§é’¥è´¦æˆ·
```typescript
// ä½¿ç”¨ viem çš„ privateKeyToAccount
const account = privateKeyToAccount(privateKey);
const client = createWalletClient({ account, ... });
```

### 2. å·¥ä½œæµç¨‹

```
1. ç”¨æˆ·æä¾›ç§é’¥
   â†“
2. åˆ›å»ºç§é’¥è´¦æˆ·ï¼ˆæ”¯æŒ signAuthorizationï¼‰
   â†“
3. æ„å»ºæ‰¹é‡æ“ä½œï¼ˆApprove + Depositï¼‰
   â†“
4. ç­¾ç½² EIP-7702 Authorization
   â†“
5. å‘é€è‡ªè°ƒç”¨äº¤æ˜“ï¼ˆto: è‡ªå·±åœ°å€ï¼‰
   â†“
6. åœ¨äº¤æ˜“ä¸­ï¼Œè´¦æˆ·ä¸´æ—¶è·å¾— Delegator ä»£ç 
   â†“
7. æ‰§è¡Œæ‰¹é‡æ“ä½œ
   â†“
8. äº¤æ˜“å®Œæˆï¼Œè´¦æˆ·æ¢å¤ä¸ºæ™®é€š EOA
```

### 3. æ ¸å¿ƒä»£ç 

```typescript
// 1. åˆ›å»ºç§é’¥è´¦æˆ·
const account = privateKeyToAccount(privateKey);
const client = createWalletClient({
    account,
    chain: sepolia,
    transport: http(),
});

// 2. ç­¾ç½²æˆæƒ
const authorization = await signAuthorization(client, {
    contractAddress: DELEGATOR_ADDRESS,
});

// 3. æ„é€ æ‰¹é‡è°ƒç”¨
const executions = [
    { target: TOKEN, value: 0n, callData: approveData },
    { target: BANK, value: 0n, callData: depositData },
];

// 4. å‘é€äº¤æ˜“
const hash = await client.sendTransaction({
    to: account.address, // è‡ªè°ƒç”¨
    data: encode('execute', [executions]),
    authorizationList: [authorization], // EIP-7702 å…³é”®
});
```

---

## ğŸ“Š å¯¹æ¯”ä¼ ç»Ÿæ–¹å¼

| é¡¹ç›® | ä¼ ç»Ÿæ–¹å¼ | EIP-7702 æ–¹å¼ |
|------|---------|--------------|
| äº¤æ˜“æ•°é‡ | 2 æ¬¡ï¼ˆApprove + Depositï¼‰ | 1 æ¬¡ |
| Gas æ¶ˆè€— | é«˜ | è¾ƒä½ |
| ç”¨æˆ·ä½“éªŒ | éœ€è¦ä¸¤æ¬¡ç¡®è®¤ | ä¸€æ¬¡ç¡®è®¤ |
| æŠ€æœ¯è¦æ±‚ | ç®€å• | éœ€è¦ç§é’¥ |
| é’±åŒ…æ”¯æŒ | æ‰€æœ‰é’±åŒ… | éœ€è¦æ”¯æŒ EIP-7702 |

---

## ğŸ” å®‰å…¨è€ƒè™‘

### ä¸ºä»€ä¹ˆéœ€è¦ç§é’¥ï¼Ÿ

1. **JSON-RPC é™åˆ¶**ï¼šé€šè¿‡æµè§ˆå™¨æ‰©å±•ï¼ˆå¦‚ MetaMaskï¼‰è¿æ¥çš„è´¦æˆ·ä¸æ”¯æŒ `signAuthorization`
2. **ç›´æ¥ç­¾å**ï¼šç§é’¥è´¦æˆ·å¯ä»¥ç›´æ¥è°ƒç”¨ viem çš„ `signAuthorization` å‡½æ•°
3. **ä¸´æ—¶ä½¿ç”¨**ï¼šä»…åœ¨æµ‹è¯•æ—¶ä½¿ç”¨ï¼Œæ­£å¼ç¯å¢ƒåº”ä½¿ç”¨æ”¯æŒ EIP-7702 çš„é’±åŒ…

### å®‰å…¨å»ºè®®

- âœ… ä»…åœ¨æµ‹è¯•ç½‘ä½¿ç”¨ç§é’¥
- âœ… ä½¿ç”¨ä¸“é—¨çš„æµ‹è¯•è´¦æˆ·
- âœ… ä¸åœ¨å…¬å…±åœºåˆæš´éœ²ç§é’¥
- âœ… æµ‹è¯•å®Œæˆåç«‹å³æ¸…é™¤ç§é’¥

---

## ğŸ“ å‚è€ƒèµ„æ–™

- [EIP-7702 ææ¡ˆ](https://eips.ethereum.org/EIPS/eip-7702)
- [Viem æ–‡æ¡£](https://viem.sh/docs/experimental/eip7702)
- [MetaMask Delegator åˆçº¦](https://etherscan.io/address/0x63c0c19a282a1B52b07dD5a65b58948A07DAE32B)
